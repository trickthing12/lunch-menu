<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>점심 추천 슬롯</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #0b0c10;
      color: #fff;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .app { width: 100%; max-width: 420px; padding: 16px; }
    .card {
      background: radial-gradient(circle at top, #2b2f4a, #111322 60%, #05060a);
      border-radius: 24px;
      padding: 20px 16px;
      min-height: 430px;
      position: relative;
      overflow: hidden;
    }

    .title { text-align: center; margin-bottom: 12px; }
    .title-main { font-size: 20px; font-weight: 700; letter-spacing: 0.08em; }
    .title-sub { font-size: 12px; opacity: 0.7; margin-top: 4px; }

    .view { width: 100%; height: calc(100% - 52px); position: relative; }
    .hidden { display: none; }

    /* ---------- 슬롯 화면 ---------- */

    .wheel-wrapper {
      width: 320px;
      height: 320px;
      margin: 0 auto;
      position: relative;
    }

    .wheel-base {
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background: radial-gradient(circle, #ffffff 25%, #f4f4f4 55%, #e8e8e8);
      box-shadow: inset 0 0 8px rgba(0,0,0,0.4);
    }

    .wheel {
      position: absolute;
      inset: 12px;
      border-radius: 50%;
      border: 4px solid rgba(0,0,0,0.18);
      transform: rotate(0deg);
    }

    .slice-divider {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 50%;
      height: 2px;
      background: rgba(0,0,0,0.18);
      transform-origin: 0 50%;
    }

    .slice-label {
      position: absolute;
      left: 50%;
      top: 50%;
      transform-origin: 0 0;
      width: 50%;
      text-align: center;
      font-size: 12px;
      color: #333;
      font-weight: 600;
    }

    .slice-label span {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.9);
      border: 1px solid rgba(0,0,0,0.08);
    }

    .pointer {
      position: absolute;
      top: 6px;
      left: 50%;
      transform: translateX(-50%);
      border-left: 12px solid transparent;
      border-right: 12px solid transparent;
      border-bottom: 18px solid #ffeb8a;
      z-index: 3;
      filter: drop-shadow(0 0 6px rgba(0,0,0,0.8));
    }

    .spin-button {
      margin-top: 20px;
      display: block;
      padding: 12px 24px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #ff7070, #ff3b3b);
      color: white;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 6px 14px rgba(0,0,0,0.6);
      white-space: nowrap;
    }

    .spin-button.disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    /* ---------- 결과 화면 ---------- */

    .result-view {
      text-align: center;
      padding-top: 16px;
    }

    .result-title {
      opacity: 0.7;
      font-size: 12px;
    }

    .result-main {
      font-size: 20px;
      font-weight: 700;
      margin: 10px 0 16px;
      line-height: 1.4;
    }

    .result-character-box {
      width: 180px;
      height: 230px;
      background: linear-gradient(135deg, #ff7bc2, #7f7bff);
      border-radius: 24px;
      overflow: hidden;
      margin: 0 auto 12px;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .result-character-box img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      background: #111;
    }

    .result-char-name {
      position: absolute;
      bottom: 6px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7);
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 12px;
      white-space: nowrap;
    }

    .result-line {
      font-size: 14px;
      margin-bottom: 12px;
      opacity: 0.9;
      line-height: 1.6;
    }

    .result-retry-button {
      border: none;
      padding: 10px 20px;
      background: rgba(255,204,92,0.2);
      border: 1px solid rgba(255,204,92,1);
      border-radius: 999px;
      color: #ffd86b;
      font-weight: 600;
      cursor: pointer;
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="card">

      <div class="title">
        <div class="title-main">LUNCH SLOT</div>
        <div class="title-sub">오늘 점심 메뉴는 캐릭터에게 맡겨보자</div>
      </div>

      <!-- 슬롯 화면 -->
      <div id="slotView" class="view">
        <div class="wheel-wrapper">
          <div class="wheel-base"></div>
          <div id="wheel" class="wheel"></div>
          <div class="pointer"></div>
        </div>

        <button id="spinButton" class="spin-button">점심 추천</button>
      </div>

      <!-- 결과 화면 -->
      <div id="resultView" class="view hidden">
        <div class="result-title">오늘의 점심 결과</div>
        <div class="result-main" id="resultMain"></div>

        <div class="result-character-box" id="resultCharacterBox">
          <span>캐릭터</span>
          <div class="result-char-name" id="resultCharName">???</div>
        </div>

        <div class="result-line" id="resultLine"></div>

        <button id="resultRetryButton" class="result-retry-button">
          메뉴 다시 추천
        </button>
      </div>

    </div>
  </div>

  <script>
    // 1. 데이터
    const CATEGORY_DATA = [
      {
        id: 0, label: "밥도둑",
        character: {
          name: "스노우 화이트",
          image: "이미지/스노우 화이트.jpg",
          line: "메뉴는 이것으로. 밥은 얼마나 준비되었지?"
        },
        menus: ["찜닭","아구찜","오므라이스","제육","덮밥","카레라이스","생선정식","게장"]
      },
      {
        id: 1, label: "면류",
        character: {
          name: "아카리",
          image: "이미지/아카리.jpg",
          line: "무한리필 맛집 추천 받아요~"
        },
        menus: ["비빔국수","스파게티","잔치국수","뇨끼","칼국수","수제비","쌀국수","막국수"]
      },
      {
        id: 2, label: "일식",
        character: {
          name: "세이버",
          image: "이미지/세이버.jpg",
          line: "한 그릇 더"
        },
        menus: ["초밥","가츠동","라멘","소바","돈부리","규동","오코노미야끼","연어덮밥"]
      },
      {
        id: 3, label: "국/찌개",
        character: {
          name: "스파스",
          image: "이미지/스파스.jpg",
          line: "국물은 살찌지 않는다고! 아마도.."
        },
        menus: ["김치찌개","육개장","뼈해장국","부대찌개","된장찌개","돼지국밥","갈치조림","순두부찌개"]
      },
      {
        id: 4, label: "중식",
        character: {
          name: "향릉",
          image: "이미지/향릉.jpg",
          line: "기다려! 내가 금방 요리해줄게!"
        },
        menus: ["마라탕","짜장면","짬뽕","탕수육","깐풍새우","새우볶음밥","마파두부","꿔바로우"]
      },
      {
        id: 5, label: "귀찮음",
        character: {
          name: "에르핀",
          image: "이미지/에르핀.jpg",
          line: "요정 여왕 나 에르핀이 이 메뉴를 추천함!"
        },
        menus: ["토스트","볶음밥","샌드위치","도시락","타코","컵라면","삼각김밥","햄버거"]
      },
      {
        id: 6, label: "헤비",
        character: {
          name: "페코린느",
          image: "이미지/페코린느.jpg",
          line: "배가 꼬륵꼬륵 소리가 나요..몸이 아니라, 마음쪽..?"
        },
        menus: ["치킨","족발","보쌈","피자","곱창","삼겹살","스테이크","닭발"]
      },
      {
        id: 7, label: "분식",
        character: {
          name: "귤복복",
          image: "이미지/귤복복.jpg",
          line: "사저를 위해 준비했어요!"
        },
        menus: ["떡볶이","어묵","순대","김밥","돈까스","라면","핫도그","튀김"]
      }
    ];

    const sliceDeg = 360 / CATEGORY_DATA.length;

    // CSS transform 기준에서:
    // 0deg = 오른쪽(3시), 90deg = 아래(6시), 180deg = 왼쪽(9시), 270deg = 위(12시)
    const pointerAngle = 270; // 실제 포인터가 있는 12시 방향

    const wheelEl = document.getElementById("wheel");
    const spinButton = document.getElementById("spinButton");
    const slotView = document.getElementById("slotView");
    const resultView = document.getElementById("resultView");

    const resultMain = document.getElementById("resultMain");
    const resultLine = document.getElementById("resultLine");
    const resultCharName = document.getElementById("resultCharName");
    const resultCharacterBox = document.getElementById("resultCharacterBox");
    const resultRetryButton = document.getElementById("resultRetryButton");

    let isSpinning = false;

    // 2. 룰렛 구성 (구분선 + 섹터 중앙 라벨)
    function setupWheel() {
      CATEGORY_DATA.forEach((cat, i) => {
        const baseAngle = i * sliceDeg;
        const centerAngle = baseAngle + sliceDeg / 2; // 섹터 중앙 각도 (3시 기준)

        // 구분선
        const divider = document.createElement("div");
        divider.className = "slice-divider";
        divider.style.transform = `rotate(${baseAngle}deg)`;
        wheelEl.appendChild(divider);

        // 라벨 – 원 중심과 테두리 중간 정도(반지름 약 60~65% 위치)
        const label = document.createElement("div");
        label.className = "slice-label";
        // translate(거리, -50%): 거리 값이 클수록 테두리 쪽, 작을수록 원 중심 쪽
        label.style.transform = `rotate(${centerAngle}deg) translate(35px, -50%)`;
        label.innerHTML = `<span>${cat.label}</span>`;
        wheelEl.appendChild(label);
      });
    }

    setupWheel();

    // 3. 결과 화면 표시
    function showResult(category, menu) {
      resultMain.textContent = `오늘 점심은 "${menu}"`;
      resultLine.textContent = category.character.line;
      resultCharName.textContent = category.character.name || "???";

      const oldImg = resultCharacterBox.querySelector("img");
      const placeholder = resultCharacterBox.querySelector("span");

      if (category.character.image) {
        if (!oldImg) {
          const img = document.createElement("img");
          img.src = category.character.image;
          img.alt = category.character.name || "캐릭터";
          resultCharacterBox.insertBefore(img, placeholder);
        } else {
          oldImg.src = category.character.image;
          oldImg.alt = category.character.name || "캐릭터";
        }
        if (placeholder) placeholder.style.display = "none";
      } else {
        if (oldImg) oldImg.remove();
        if (placeholder) {
          placeholder.style.display = "block";
          placeholder.textContent = "캐릭터";
        }
      }

      slotView.classList.add("hidden");
      resultView.classList.remove("hidden");
    }

    // 4. 회전 + 결과 연동
    function spin() {
      if (isSpinning) return;
      isSpinning = true;
      spinButton.classList.add("disabled");

      // 항상 슬롯 화면에서 시작
      resultView.classList.add("hidden");
      slotView.classList.remove("hidden");

      // 1) 어떤 카테고리에 멈출지 먼저 결정
      const chosenIndex = Math.floor(Math.random() * CATEGORY_DATA.length);
      const category = CATEGORY_DATA[chosenIndex];
      const menu = category.menus[Math.floor(Math.random() * category.menus.length)];

      // 2) 그 카테고리 섹터 중앙이 포인터(12시)에 오도록 회전 각도 계산
      const sectorCenterAngle = sliceDeg * chosenIndex + sliceDeg / 2; // 3시 기준
      const randomTurns = 5 + Math.floor(Math.random() * 3); // 5~7바퀴
      const finalRotation = randomTurns * 360 + (pointerAngle - sectorCenterAngle);

      // 3) 이전 회전 상태 초기화 후 애니메이션
      wheelEl.style.transition = "none";
      wheelEl.style.transform = "rotate(0deg)";
      void wheelEl.offsetWidth; // 리플로우

      wheelEl.style.transition = "transform 3s cubic-bezier(0.21,0.95,0.45,1)";
      wheelEl.style.transform = `rotate(${finalRotation}deg)`;

      setTimeout(() => {
        isSpinning = false;
        spinButton.classList.remove("disabled");
        showResult(category, menu);
      }, 3100);
    }

    // 5. 이벤트
    spinButton.addEventListener("click", spin);
    resultRetryButton.addEventListener("click", spin);
  </script>
</body>
</html>
